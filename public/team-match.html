<!DOCTYPE html>
<html lang="zh">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>巢 League S1</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="css/styles.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <style>
        .team-color {
            text-shadow: -1px -1px 0 #fff, 1px -1px 0 #fff, -1px 1px 0 #fff, 1px 1px 0 #fff;
        }
    </style>
</head>

<body class="bg-light">
    <nav class="navbar navbar-expand-lg navbar-dark bg-primary">
        <div class="container-fluid">
            <a class="navbar-brand fw-bold" href="/">巢</a>
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav">
                <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse navbar-collapse" id="navbarNav">
                <ul class="navbar-nav">
                    <li class="nav-item">
                        <a class="nav-link" href="/">记分</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="/rankings.html">排名</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="/team-match.html?s=0" id="nav-0zh">巢 League S1</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="/team-match.html?s=1&l=zh" id="nav-1zh">巢 League S2</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="/team-match.html?s=1&l=en" id="nav-1en">Nest League S2</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="/game-record.html?s=1">S2 Record Game</a>
                    </li>
                </ul>
            </div>
        </div>
    </nav>

    <div class="container mt-4">
        <!-- 团队排名 -->
        <div class="row mb-4">
            <div class="col">
                <div class="card">
                    <div class="card-header">
                        <h5 class="mb-0 text-team-ranking-title"></h5>
                    </div>
                    <div class="card-body">
                        <div class="table-responsive">
                            <table class="table table-hover">
                                <thead class="table-primary">
                                    <tr>
                                        <th class="text-team-name"></th>
                                        <th class="text-games"></th>
                                        <th class="text-total-pt"></th>
                                        <th class="text-avg-placement"></th>
                                        <th class="text-placements"></th>
                                    </tr>
                                </thead>
                                <tbody id="teamRankings" class="tr-hover-first-child-exempt">
                                    <!-- 团队排名将通过JavaScript动态填充 -->
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- 近期比赛部分 -->
        <div class="row mb-4">
            <div class="col">
                <div class="card">
                    <div class="card-header d-flex justify-content-between align-items-center">
                        <h5 class="mb-0 text-recent-team-matches"></h5>
                        <button class="btn btn-success text-record-a-game" data-bs-toggle="modal"
                            data-bs-target="#recordMatchModal"></button>
                    </div>
                    <div class="card-body">
                        <div class="table-responsive">
                            <table class="table table-hover">
                                <thead class="table-primary">
                                    <tr>
                                        <th class="text-time"></th>
                                        <th class="text-1st"></th>
                                        <th class="text-2nd"></th>
                                        <th class="text-3rd"></th>
                                        <th class="text-4th"></th>
                                        <th class="text-modify"></th>
                                    </tr>
                                </thead>
                                <tbody id="recentMatchRecords">
                                    <!-- 比赛记录将通过JavaScript动态填充 -->
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- 个人排名 -->
        <div class="row mb-4" id="playerRankingsTable">
            <div class="col">
                <div class="card">
                    <div class="card-header">
                        <h5 class="mb-0 text-player-ranking-title"></h5>
                    </div>
                    <div class="card-body">
                        <div class="table-responsive">
                            <table class="table table-hover">
                                <thead class="table-primary">
                                    <tr>
                                        <th class="text-player"></th>
                                        <th class="text-team"></th>
                                        <th class="sortable" data-sort="games"><span
                                                class="text-games">Games</span><button class="btn btn-sm sort-btn"
                                                data-sort="games"><i class="fas fa-sort"></i></button></th>
                                        <th class="sortable" data-sort="totalPT"><span class="text-total-pt">Total
                                                PT</span><button class="btn btn-sm sort-btn" data-sort="totalPT"><i
                                                    class="fas fa-sort"></i></button></th>
                                        <th class="sortable" data-sort="avgPlacement"><span
                                                class="text-avg-placement">Avg Placement</span><button
                                                class="btn btn-sm sort-btn" data-sort="avgPlacement"><i
                                                    class="fas fa-sort"></i></button></th>
                                        <th class="text-win-rate-tooltip sortable" data-bs-toggle="tooltip"
                                            data-bs-placement="top" data-sort="winRate"><span class="text-win-rate">Win
                                                Rate</span><button class="btn btn-sm sort-btn" data-sort="winRate"><i
                                                    class="fas fa-sort"></i></button></th>
                                        <th class="text-deal-in-rate-tooltip sortable" data-bs-toggle="tooltip"
                                            data-bs-placement="top" data-sort="dealInRate"><span
                                                class="text-deal-in-rate">Deal In Rate</span><button
                                                class="btn btn-sm sort-btn" data-sort="dealInRate"><i
                                                    class="fas fa-sort"></i></button></th>
                                        <th class="text-tsumo-rate-tooltip sortable" data-bs-toggle="tooltip"
                                            data-bs-placement="top" data-sort="tsumoRate"><span
                                                class="text-tsumo-rate">Tsumo Rate</span><button
                                                class="btn btn-sm sort-btn" data-sort="tsumoRate"><i
                                                    class="fas fa-sort"></i></button></th>
                                        <th class="text-call-rate-tooltip sortable" data-bs-toggle="tooltip"
                                            data-bs-placement="top" data-sort="callRate"><span
                                                class="text-call-rate">Call Rate</span><button
                                                class="btn btn-sm sort-btn" data-sort="callRate"><i
                                                    class="fas fa-sort"></i></button></th>
                                        <th class="text-riichi-rate-tooltip sortable" data-bs-toggle="tooltip"
                                            data-bs-placement="top" data-sort="riichiRate"><span
                                                class="text-riichi-rate">Riichi Rate</span><button
                                                class="btn btn-sm sort-btn" data-sort="riichiRate"><i
                                                    class="fas fa-sort"></i></button></th>
                                        <th class="text-riichi-win-rate-tooltip sortable" data-bs-toggle="tooltip"
                                            data-bs-placement="top" data-sort="riichiWinRate"><span
                                                class="text-riichi-win-rate">Riichi Win Rate</span><button
                                                class="btn btn-sm sort-btn" data-sort="riichiWinRate"><i
                                                    class="fas fa-sort"></i></button></th>
                                        <th class="text-dama-rate-tooltip sortable" data-bs-toggle="tooltip"
                                            data-bs-placement="top" data-sort="damaRate"><span
                                                class="text-dama-rate">Dama Rate</span><button
                                                class="btn btn-sm sort-btn" data-sort="damaRate"><i
                                                    class="fas fa-sort"></i></button></th>
                                        <th class="text-draw-tenpai-rate-tooltip sortable" data-bs-toggle="tooltip"
                                            data-bs-placement="top" data-sort="drawTenpaiRate"><span
                                                class="text-draw-tenpai-rate">Draw Tenpai Rate</span><button
                                                class="btn btn-sm sort-btn" data-sort="drawTenpaiRate"><i
                                                    class="fas fa-sort"></i></button></th>
                                    </tr>
                                </thead>
                                <tbody id="playerRankings" class="tr-hover-first-child-exempt">
                                    <!-- 个人排名将通过JavaScript动态填充 -->
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- 全部比赛部分 -->
        <div class="row mb-4">
            <div class="col">
                <div class="card">
                    <div class="card-header d-flex justify-content-between align-items-center">
                        <h5 class="mb-0 text-all-team-matches"></h5>
                    </div>
                    <div class="card-body">
                        <div class="table-responsive">
                            <table class="table table-hover">
                                <thead class="table-primary">
                                    <tr>
                                        <th class="text-time"></th>
                                        <th class="text-1st"></th>
                                        <th class="text-2nd"></th>
                                        <th class="text-3rd"></th>
                                        <th class="text-4th"></th>
                                        <th class="text-modify"></th>
                                    </tr>
                                </thead>
                                <tbody id="allMatchRecords">
                                    <!-- 比赛记录将通过JavaScript动态填充 -->
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- 团队管理部分 -->
        <div class="row mb-4">
            <div class="col">
                <div class="card">
                    <div class="card-header d-flex justify-content-between align-items-center">
                        <h5 class="mb-0 text-team-management"></h5>
                        <button class="btn btn-primary text-add-a-team" data-bs-toggle="modal"
                            data-bs-target="#createTeamModal"></button>
                    </div>
                    <div class="card-body">
                        <div id="teamsList">
                            <!-- 团队列表将通过JavaScript动态加载 -->
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- 创建团队模态框 -->
    <div class="modal fade" id="createTeamModal" tabindex="-1">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title text-add-team"></h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <form id="createTeamForm">
                        <div class="mb-3">
                            <label for="teamName" class="form-label text-team-name"></label>
                            <input type="text" class="form-control" id="teamName" required>
                        </div>
                        <div class="mb-3">
                            <label for="teamColor" class="form-label text-team-eng-name"></label>
                            <input type="text" class="form-control" id="teamEngName">
                        </div>
                        <div class="mb-3">
                            <label for="teamColor" class="form-label text-team-color"></label>
                            <input type="color" class="form-control form-control-color" id="teamColor" value="#000000"
                                required>
                        </div>
                        <div class="mb-3">
                            <label class="form-label text-members-label"></label>
                            <div id="memberSelection" class="border rounded p-3"
                                style="max-height: 200px; overflow-y: auto;">
                                <!-- 成员选择列表将通过JavaScript动态加载 -->
                            </div>
                        </div>
                        <div class="text-end">
                            <button type="button" class="btn btn-secondary text-cancel"
                                data-bs-dismiss="modal"></button>
                            <button type="submit" class="btn btn-primary text-submit"></button>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>

    <!-- 记录比赛模态框 -->
    <div class="modal fade" id="recordMatchModal" tabindex="-1">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title text-record-match-title"></h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <form id="recordMatchForm">
                        <div class="table-responsive">
                            <table class="table">
                                <thead>
                                    <tr>
                                        <th class="text-placement"></th>
                                        <th class="text-player"></th>
                                        <th class="text-score"></th>
                                        <th>PT</th>
                                        <th>Chombo</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <tr>
                                        <td class="text-1st"></td>
                                        <td>
                                            <select class="form-select" name="player" required>
                                                <option value="" class="text-choose-player"></option>
                                            </select>
                                            <div class="mt-1">
                                                <input type="text"
                                                    class="form-control form-control-sm text-team-placeholder"
                                                    name="team" readonly>
                                            </div>
                                        </td>
                                        <td>
                                            <input type="number" class="form-control" name="score" required>
                                        </td>
                                        <td class="pt-value">-</td>
                                        <td>
                                            <div class="form-check">
                                                <input class="form-check-input" type="checkbox" name="chombo">
                                            </div>
                                        </td>
                                    </tr>
                                    <tr>
                                        <td class="text-2nd"></td>
                                        <td>
                                            <select class="form-select" name="player" required>
                                                <option value="" class="text-choose-player"></option>
                                            </select>
                                            <div class="mt-1">
                                                <input type="text"
                                                    class="form-control form-control-sm text-team-placeholder"
                                                    name="team" readonly>
                                            </div>
                                        </td>
                                        <td>
                                            <input type="number" class="form-control" name="score" required>
                                        </td>
                                        <td class="pt-value">-</td>
                                        <td>
                                            <div class="form-check">
                                                <input class="form-check-input" type="checkbox" name="chombo">
                                            </div>
                                        </td>
                                    </tr>
                                    <tr>
                                        <td class="text-3rd"></td>
                                        <td>
                                            <select class="form-select" name="player" required>
                                                <option value="" class="text-choose-player"></option>
                                            </select>
                                            <div class="mt-1">
                                                <input type="text"
                                                    class="form-control form-control-sm text-team-placeholder"
                                                    name="team" readonly>
                                            </div>
                                        </td>
                                        <td>
                                            <input type="number" class="form-control" name="score" required>
                                        </td>
                                        <td class="pt-value">-</td>
                                        <td>
                                            <div class="form-check">
                                                <input class="form-check-input" type="checkbox" name="chombo">
                                            </div>
                                        </td>
                                    </tr>
                                    <tr>
                                        <td class="text-4th"></td>
                                        <td>
                                            <select class="form-select" name="player" required>
                                                <option value="" class="text-choose-player"></option>
                                            </select>
                                            <div class="mt-1">
                                                <input type="text"
                                                    class="form-control form-control-sm text-team-placeholder"
                                                    name="team" readonly>
                                            </div>
                                        </td>
                                        <td>
                                            <input type="number" class="form-control" name="score" required>
                                        </td>
                                        <td class="pt-value">-</td>
                                        <td>
                                            <div class="form-check">
                                                <input class="form-check-input" type="checkbox" name="chombo">
                                            </div>
                                        </td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                        <div class="text-muted mt-2">
                            <small class="text-note"></small>
                        </div>
                        <div class="text-end mt-3">
                            <button type="button" class="btn btn-secondary text-cancel"
                                data-bs-dismiss="modal"></button>
                            <button type="submit" class="btn btn-primary text-submit"></button>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>

    <!-- 编辑团队模态框 -->
    <div class="modal fade" id="editTeamModal" tabindex="-1">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title text-edit-team-title"></h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <form id="editTeamForm">
                        <div class="mb-3">
                            <label for="adminPassword" class="form-label text-password-label"></label>
                            <input type="password" class="form-control" id="adminPassword" required>
                        </div>
                        <div class="mb-3">
                            <label for="editTeamName" class="form-label text-team-name"></label>
                            <input type="text" class="form-control" id="editTeamName" required>
                            <input type="hidden" id="originalTeamName">
                        </div>
                        <div class="mb-3">
                            <label for="editTeamColor" class="form-label text-team-color"></label>
                            <input type="color" class="form-control form-control-color" id="editTeamColor" required>
                        </div>
                        <div class="text-end">
                            <button type="button" class="btn btn-secondary text-cancel"
                                data-bs-dismiss="modal"></button>
                            <button type="submit" class="btn btn-primary text-submit"></button>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>
    <script>
        const season = parseInt(new URLSearchParams(window.location.search).get("s"), 10) || 0;
        const lang = new URLSearchParams(window.location.search).get("l") || "zh";
        const Text = {
            byClass: {
                "text-time": ["时间", "时间", "Time"],
                "text-1st": ["一位", "一位", "1st"],
                "text-2nd": ["二位", "二位", "2nd"],
                "text-3rd": ["三位", "三位", "3rd"],
                "text-4th": ["四位", "四位", "4th"],
                "text-choose-player": ["选择玩家", "选择玩家", "Choose player"],
                "text-team-name": ["团队名称", "团队名称", "Name"],
                "text-team-eng-name": ["英文名称", "英文名称", "English Name"],
                "text-team-color": ["团队颜色", "团队颜色", "Color"],
                "text-cancel": ["取消", "取消", "Cancel"],
                "text-total-pt": ["总PT", "总PT", "PT"],
                "text-avg-placement": ["均顺", "均顺", "Avg Rank"],
                "text-win-rate": ["和率", "和率", "Win Rate"],
                "text-deal-in-rate": ["铳率", "铳率", "Deal-in Rate"],
                "text-tsumo-rate": ["自摸率", "自摸率", "Tsumo Rate"],
                "text-call-rate": ["副露率", "副露率", "Call Rate"],
                "text-riichi-rate": ["立直率", "立直率", "Riichi Rate"],
                "text-riichi-win-rate": ["立直成功", "立直成功", "Riichi Win"],
                "text-dama-rate": ["默听率", "默听率", "Dama Rate"],
                "text-draw-tenpai-rate": ["流听率", "流听率", "Draw Tenpai"],
                "text-placements": ["顺位", "顺位", "Ranks"],
                "text-recent-team-matches": ["近期比赛", "近期比赛", "Recent Games"],
                "text-all-team-matches": ["全部比赛", "全部比赛", "All Games"],
                "text-record-a-game": ["记录比赛", "记录比赛", "Record a game"],
                "text-modify": ["操作", "操作", "Modify"],
                "text-team-ranking-title": ["团队排名", "团队排名", "Team Ranking"],
                "text-player-ranking-title": ["个人排名", "个人排名", "Player Ranking"],
                "text-player": ["玩家", "玩家", "Name"],
                "text-team": ["所属队伍", "所属队伍", "Team"],
                "text-games": ["场数", "场数", "Played"],
                "text-team-management": ["团队管理", "团队管理", "Team Management"],
                "text-add-a-team": ["创建团队", "创建团队", "Add a team"],
                "text-members-label": ["选择成员", "选择成员", "Choose members"],
                "text-submit": ["确认", "确认", "OK"],
                "text-record-match-title": ["记录团队赛", "记录团队赛", "Record a game"],
                "text-placement": ["顺位", "顺位", "Placement"],
                "text-score": ["得点", "得点", "Score"],
                "text-note": ["注意：得点总和应为 120,000", "注意：得点总和应为 120,000", "Note: Total score should be 120,000"],
                "text-edit-team-title": ["编辑团队", "编辑团队", "Modify a team"],
                "text-password-label": ["管理员密码", "管理员密码", "Admin password"]
            },
            toolTips: {
                "text-win-rate-tooltip": ["和了局数 / 总局数", "和了局数 / 总局数", "Win rounds / Total rounds"],
                "text-deal-in-rate-tooltip": ["放铳局数 / 总局数", "放铳局数 / 总局数", "Deal-in rounds / Total rounds"],
                "text-tsumo-rate-tooltip": ["自摸局数 / 和了局数", "自摸局数 / 和了局数", "Tsumo rounds / Win rounds"],
                "text-call-rate-tooltip": ["副露局数 / 总局数", "副露局数 / 总局数", "Call rounds / Total rounds"],
                "text-riichi-rate-tooltip": ["立直局数 / 总局数", "立直局数 / 总局数", "Riichi rounds / Total rounds"],
                "text-riichi-win-rate-tooltip": ["立直和了局数 / 立直局数", "立直和了局数 / 立直局数", "Win after riichi rounds / Riichi rounds"],
                "text-dama-rate-tooltip": ["默听和了局数 / 和了局数", "默听和了局数 / 和了局数", "Dama win rounds / Total rounds"],
                "text-draw-tenpai-rate-tooltip": ["流局听牌局数 / 流局数", "流局听牌局数 / 流局数", "Tenpai at draw rounds / Draw rounds"],
            },
            other: {
                "title": ["巢 League S1", "巢 League S2", "Nest League S2"],
                "text-team-placeholder": ["所属队伍", "所属队伍", "Team"],
            },
            init() {
                if (season === 0) {
                    this.index = 0;
                } else if (season === 1 && lang === "zh") {
                    this.index = 1;
                } else if (season === 1 && lang === "en") {
                    this.index = 2;
                }
            },
        };
        Text.init();
        document.getElementById(`nav-${season}${lang}`).classList.add("active");
        document.title = Text.other["title"][Text.index];
        [...document.getElementsByClassName("text-team-placeholder")].forEach(e => { e.placeholder = Text.other["text-team-placeholder"][Text.index]; });
        Object.keys(Text.byClass).forEach(className => {
            try {
                [...document.getElementsByClassName(className)].forEach(e => { e.innerText = Text.byClass[className][Text.index] });
            }
            catch (error) {
                console.error(`Setting text failed for ${className}`);
            }
        });
        Object.keys(Text.toolTips).forEach(className => {
            try {
                [...document.getElementsByClassName(className)].forEach(e => {
                    if (season === 1) e.title = Text.toolTips[className][Text.index];
                    else e.style.display = "none";
                });
            }
            catch (error) {
                console.error(`Setting tooltip failed for ${className}`);
            }
        });
    </script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>
    <script src="js/components/team-manager.js"></script>
    <script src="js/utils/auth.js"></script>
    <script src="js/utils/pt.js"></script>
    <script src="js/components/team-match-manager.js"></script>
</body>

</html>